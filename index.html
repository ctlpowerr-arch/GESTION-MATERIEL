<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TECHNIC-GEST - Gestion de Matériel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/TextureLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #f97316;
            --accent-color: #10b981;
            --dark-color: #1e293b;
            --light-color: #f8fafc;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --success-color: #10b981;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--light-color) 0%, #e2e8f0 100%);
            color: var(--dark-color);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1d4ed8 100%);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            color: white;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
            color: var(--primary-color);
        }
        
        .app-name {
            font-size: 1.8rem;
            font-weight: 800;
            color: white;
        }
        
        .company-name {
            opacity: 0.9;
            font-size: 0.9rem;
            margin-top: 3px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
        }
        
        .user-info i {
            font-size: 1.2rem;
        }
        
        .user-info span {
            font-weight: 600;
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            border-radius: 20px;
            padding: 25px 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .sidebar h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(59, 130, 246, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sidebar h3 i {
            font-size: 1.2rem;
        }
        
        .menu-item {
            padding: 14px 15px;
            margin-bottom: 8px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            color: var(--dark-color);
            font-weight: 500;
        }
        
        .menu-item:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateX(5px);
        }
        
        .menu-item.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        
        .menu-item i {
            width: 20px;
        }
        
        .stats {
            margin-top: 30px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(59, 130, 246, 0.1);
        }
        
        .stats h3 {
            color: var(--secondary-color);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .stat-value {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        /* Content Area */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Dashboard */
        .dashboard {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }
        
        .dashboard h2 {
            color: var(--dark-color);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 15px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            border: 1px solid rgba(59, 130, 246, 0.1);
            cursor: pointer;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }
        
        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .card-content h4 {
            font-size: 1rem;
            margin-bottom: 5px;
            color: #64748b;
        }
        
        .card-content p {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-color);
        }
        
        /* Warehouse 3D */
        .warehouse-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .warehouse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .warehouse-header h2 {
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.2);
            color: var(--primary-color);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .control-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--primary-color);
        }
        
        #warehouse-3d {
            width: 100%;
            flex: 1;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 15px;
            overflow: hidden;
            min-height: 500px;
            border: 2px solid rgba(59, 130, 246, 0.1);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 1000px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1d4ed8 100%);
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }
        
        .modal-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
        }
        
        .close-modal {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-color);
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            color: var(--dark-color);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: white;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1d4ed8 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: var(--dark-color);
            border: 2px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        /* Material List */
        .material-list {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }
        
        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .list-header h3 {
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 25px;
            background: #f8fafc;
            padding: 20px;
            border-radius: 15px;
        }
        
        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 15px 15px 15px 50px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
        }
        
        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }
        
        .filter-select {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: var(--dark-color);
            font-size: 1rem;
            min-width: 200px;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            border: 1px solid #e2e8f0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        th {
            padding: 20px;
            text-align: left;
            color: var(--primary-color);
            font-weight: 700;
            border-bottom: 2px solid #e2e8f0;
            white-space: nowrap;
        }
        
        td {
            padding: 20px;
            border-bottom: 1px solid #f1f5f9;
            color: var(--dark-color);
        }
        
        .progress-container {
            width: 100px;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .progress-good {
            background: var(--success-color);
        }
        
        .progress-warning {
            background: var(--warning-color);
        }
        
        .progress-bad {
            background: var(--danger-color);
        }
        
        .condition-value {
            font-weight: 700;
            color: var(--dark-color);
        }
        
        .actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: none;
            background: #f1f5f9;
            color: var(--primary-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }
        
        /* Image upload */
        .image-upload-container {
            border: 3px dashed #e2e8f0;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .image-upload-container:hover {
            border-color: var(--primary-color);
            background: rgba(59, 130, 246, 0.05);
        }
        
        .image-upload-container i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .image-upload-container p {
            color: #64748b;
            margin-bottom: 10px;
        }
        
        .image-upload-container input {
            display: none;
        }
        
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        .preview-item {
            width: 120px;
            height: 120px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            border: 3px solid #e2e8f0;
        }
        
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Color picker */
        .color-picker-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .color-option.selected {
            border-color: var(--dark-color);
            transform: scale(1.1);
        }
        
        /* Shelf selection */
        .shelf-selection {
            margin-top: 20px;
        }
        
        .shelf-visualization {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
            background: #f8fafc;
            padding: 20px;
            border-radius: 15px;
        }
        
        .shelf-row {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .shelf-position {
            width: 70px;
            height: 70px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px dashed #cbd5e1;
            color: #64748b;
            font-weight: 600;
            background: white;
        }
        
        .shelf-position:hover {
            border-color: var(--primary-color);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .shelf-position.occupied {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border: 3px solid #cbd5e1;
            cursor: not-allowed;
            color: #94a3b8;
        }
        
        .shelf-position.selected {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1d4ed8 100%);
            border-color: var(--primary-color);
            color: white;
        }
        
        /* Material Detail Modal */
        .material-detail {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
        }
        
        .material-image {
            flex: 1;
            min-width: 300px;
        }
        
        .material-image img {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .material-info {
            flex: 2;
            min-width: 300px;
        }
        
        .info-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 600;
            color: #64748b;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.1rem;
            color: var(--dark-color);
        }
        
        /* Footer */
        footer {
            background: linear-gradient(135deg, var(--dark-color) 0%, #0f172a 100%);
            padding: 25px;
            text-align: center;
            color: white;
            margin-top: 20px;
        }
        
        /* Toastr Customization */
        .toast-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);
        }
        
        .toast-error {
            background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);
        }
        
        .toast-info {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1d4ed8 100%);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: static;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .warehouse-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-filters {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .filter-select {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <div class="logo">TG</div>
                <div>
                    <div class="app-name">TECHNIC-GEST</div>
                    <div class="company-name">Gestion de Matériel Technique Professionnel</div>
                </div>
            </div>
            
            <div class="user-info">
                <i class="fas fa-user-shield"></i>
                <div>
                    <div>Connecté en tant que</div>
                    <span>LEMOQUE JUNIOR</span>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <h3><i class="fas fa-tachometer-alt"></i> Tableau de Bord</h3>
                
                <div class="menu-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Tableau de bord</span>
                </div>
                
                <div class="menu-item" data-section="warehouse">
                    <i class="fas fa-warehouse"></i>
                    <span>Entrepôt 3D</span>
                </div>
                
                <div class="menu-item" data-section="materials">
                    <i class="fas fa-tools"></i>
                    <span>Matériel Technicien</span>
                </div>
                
                <div class="menu-item" data-section="add-material">
                    <i class="fas fa-plus-circle"></i>
                    <span>Ajouter Matériel</span>
                </div>
                
                <div class="menu-item" data-section="shelves">
                    <i class="fas fa-layer-group"></i>
                    <span>Gestion Étagères</span>
                </div>
                
                <div class="menu-item" data-section="inspections">
                    <i class="fas fa-clipboard-check"></i>
                    <span>Inspections</span>
                </div>
                
                <div class="menu-item" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Rapports & Stats</span>
                </div>
                
                <div class="stats">
                    <h3><i class="fas fa-chart-line"></i> Statistiques</h3>
                    <div class="stat-item">
                        <span>Matériel total</span>
                        <span class="stat-value" id="stat-total">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Condition ≥ 80%</span>
                        <span class="stat-value" id="stat-good">0</span>
                    </div>
                    <div class="stat-item">
                        <span>À inspecter</span>
                        <span class="stat-value" id="stat-warning">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Condition ≤ 40%</span>
                        <span class="stat-value" id="stat-bad">0</span>
                    </div>
                </div>
            </div>
            
            <div class="content-area">
                <!-- Dashboard Section -->
                <div class="dashboard" id="dashboard-section">
                    <h2><i class="fas fa-tachometer-alt"></i> Tableau de Bord</h2>
                    
                    <div class="dashboard-cards">
                        <div class="card" data-section="materials">
                            <div class="card-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white;">
                                <i class="fas fa-tools"></i>
                            </div>
                            <div class="card-content">
                                <h4>Matériel Total</h4>
                                <p id="card-total">0</p>
                            </div>
                        </div>
                        
                        <div class="card" data-section="materials" data-filter="state=good">
                            <div class="card-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="card-content">
                                <h4>En excellent état</h4>
                                <p id="card-good">0</p>
                            </div>
                        </div>
                        
                        <div class="card" data-section="inspections">
                            <div class="card-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="card-content">
                                <h4>Inspections cette semaine</h4>
                                <p id="card-inspections">0</p>
                            </div>
                        </div>
                        
                        <div class="card" data-section="warehouse">
                            <div class="card-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;">
                                <i class="fas fa-warehouse"></i>
                            </div>
                            <div class="card-content">
                                <h4>Étagères utilisées</h4>
                                <p id="card-shelves">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="material-list">
                        <div class="list-header">
                            <h3><i class="fas fa-history"></i> Derniers Matériels Ajoutés</h3>
                            <button class="btn btn-primary" id="quick-add">
                                <i class="fas fa-plus"></i> Ajout Rapide
                            </button>
                        </div>
                        
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>Catégorie</th>
                                        <th>Date Ajout</th>
                                        <th>Condition</th>
                                        <th>Position</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-materials">
                                    <!-- Les matériels récents seront chargés ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Warehouse 3D Section -->
                <div class="warehouse-container" id="warehouse-section" style="display: none;">
                    <div class="warehouse-header">
                        <h2><i class="fas fa-warehouse"></i> Entrepôt 3D - Visualisation Interactive</h2>
                        <div class="controls">
                            <button class="control-btn" id="create-shelf-btn">
                                <i class="fas fa-plus"></i> Créer Étagère
                            </button>
                            <button class="control-btn" id="reset-view">
                                <i class="fas fa-sync-alt"></i> Vue Initiale
                            </button>
                            <button class="control-btn" id="toggle-labels">
                                <i class="fas fa-tag"></i> Étiquettes
                            </button>
                            <button class="control-btn" id="toggle-grid">
                                <i class="fas fa-th"></i> Grille
                            </button>
                        </div>
                    </div>
                    
                    <div id="warehouse-3d"></div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 20px; flex-wrap: wrap; padding: 20px; background: #f8fafc; border-radius: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 20px; height: 20px; background-color: #10b981; border-radius: 4px;"></div>
                            <span style="color: var(--dark-color); font-weight: 600;">Excellent (80-100%)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 20px; height: 20px; background-color: #f59e0b; border-radius: 4px;"></div>
                            <span style="color: var(--dark-color); font-weight: 600;">Bon (40-79%)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 20px; height: 20px; background-color: #ef4444; border-radius: 4px;"></div>
                            <span style="color: var(--dark-color); font-weight: 600;">À remplacer (0-39%)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 20px; height: 20px; background-color: #64748b; border-radius: 4px;"></div>
                            <span style="color: var(--dark-color); font-weight: 600;">Étagère vide</span>
                        </div>
                    </div>
                </div>
                
                <!-- Materials List Section -->
                <div class="material-list" id="materials-section" style="display: none;">
                    <div class="list-header">
                        <h3><i class="fas fa-tools"></i> Gestion du Matériel</h3>
                        <div>
                            <button class="btn btn-secondary" id="export-btn">
                                <i class="fas fa-download"></i> Exporter
                            </button>
                            <button class="btn btn-primary" id="add-material-btn">
                                <i class="fas fa-plus"></i> Ajouter Matériel
                            </button>
                        </div>
                    </div>
                    
                    <div class="search-filters">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="search-input" placeholder="Rechercher un matériel...">
                        </div>
                        <select class="filter-select" id="category-filter">
                            <option value="">Toutes les catégories</option>
                            <option value="informatique">Informatique</option>
                            <option value="outillage">Outillage</option>
                            <option value="mesure">Mesure</option>
                            <option value="reseau">Réseau</option>
                            <option value="divers">Divers</option>
                        </select>
                        <select class="filter-select" id="state-filter">
                            <option value="">Tous les états</option>
                            <option value="good">Excellent</option>
                            <option value="warning">Bon</option>
                            <option value="bad">À remplacer</option>
                        </select>
                        <select class="filter-select" id="shelf-filter">
                            <option value="">Toutes les étagères</option>
                            <!-- Les options seront chargées dynamiquement -->
                        </select>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Catégorie</th>
                                    <th>Date Ajout</th>
                                    <th>Condition</th>
                                    <th>Position</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="materials-table-body">
                                <!-- Les données seront chargées dynamiquement -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 10px;">
                        <div id="materials-count">0 matériel(s) trouvé(s)</div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-secondary" id="prev-page" disabled>
                                <i class="fas fa-chevron-left"></i> Précédent
                            </button>
                            <span id="page-info">Page 1</span>
                            <button class="btn btn-secondary" id="next-page" disabled>
                                Suivant <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Shelves Management Section -->
                <div class="dashboard" id="shelves-section" style="display: none;">
                    <h2><i class="fas fa-layer-group"></i> Gestion des Étagères</h2>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <p style="color: #64748b;">Créez et gérez les étagères de votre entrepôt</p>
                        <button class="btn btn-primary" id="create-shelf-modal-btn">
                            <i class="fas fa-plus"></i> Créer une Étagère
                        </button>
                    </div>
                    
                    <div class="dashboard-cards" id="shelves-cards">
                        <!-- Les étagères seront chargées ici -->
                    </div>
                </div>
                
                <!-- Inspections Section -->
                <div class="dashboard" id="inspections-section" style="display: none;">
                    <h2><i class="fas fa-clipboard-check"></i> Gestion des Inspections</h2>
                    
                    <div style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="color: var(--dark-color); margin-bottom: 10px;">Planification des inspections</h3>
                            <p style="color: #64748b;">Planifiez et gérez les inspections de votre matériel</p>
                        </div>
                        <button class="btn btn-primary" id="new-inspection-btn">
                            <i class="fas fa-calendar-plus"></i> Nouvelle Inspection
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Matériels</th>
                                    <th>Inspecteur</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inspections-table-body">
                                <!-- Les inspections seront chargées ici -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Reports Section -->
                <div class="dashboard" id="reports-section" style="display: none;">
                    <h2><i class="fas fa-chart-bar"></i> Rapports & Statistiques</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                            <h3 style="color: var(--primary-color); margin-bottom: 15px;">Condition du matériel</h3>
                            <div id="condition-chart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                                <!-- Graphique circulaire -->
                            </div>
                        </div>
                        
                        <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                            <h3 style="color: var(--secondary-color); margin-bottom: 15px;">Répartition par catégorie</h3>
                            <div id="category-chart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                                <!-- Graphique en barres -->
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;">
                        <h3 style="color: var(--dark-color); margin-bottom: 15px;">Historique des inspections</h3>
                        <div id="inspection-history" style="min-height: 200px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                            <!-- Graphique en ligne -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>TECHNIC-GEST &copy; 2023 - Système de Gestion de Matériel Technique Professionnel</p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">Powered by MongoDB Atlas | Utilisateur: LEMOQUE JUNIOR | Dernière connexion: Aujourd'hui</p>
        </footer>
    </div>
    
    <!-- Modal pour ajouter du matériel -->
    <div class="modal" id="addMaterialModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> Ajouter un Nouveau Matériel</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-material-form" enctype="multipart/form-data">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="material-name">Nom du Matériel *</label>
                            <input type="text" id="material-name" class="form-control" required placeholder="Ex: Ordinateur Portable Dell XPS">
                        </div>
                        <div class="form-group">
                            <label for="material-category">Catégorie *</label>
                            <select id="material-category" class="form-control" required>
                                <option value="">Sélectionner une catégorie</option>
                                <option value="informatique">Informatique</option>
                                <option value="outillage">Outillage</option>
                                <option value="mesure">Matériel de Mesure</option>
                                <option value="reseau">Réseau & Communication</option>
                                <option value="divers">Divers</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="entry-date">Date d'Entrée *</label>
                            <input type="date" id="entry-date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="material-condition">Condition du Matériel *</label>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <input type="range" id="material-condition" min="0" max="100" value="80" class="form-control" style="flex: 1; padding: 0;">
                                <span id="condition-value" style="font-weight: bold; color: var(--primary-color); min-width: 50px;">80%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px; color: #64748b; font-size: 0.9rem;">
                                <span>0%</span>
                                <span>100%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="material-description">Description</label>
                        <textarea id="material-description" class="form-control" rows="2" placeholder="Description du matériel..."></textarea>
                    </div>
                    
                    <!-- Section pour l'image -->
                    <div class="form-group">
                        <label>Image du Matériel *</label>
                        <div class="image-upload-container" id="image-upload-area">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Cliquez pour importer une image du matériel</p>
                            <p style="font-size: 0.9rem; color: #64748b;">Format JPG, PNG ou GIF (max 5MB)</p>
                            <input type="file" id="material-image-input" accept="image/*" required>
                        </div>
                        <div class="image-preview" id="image-preview-container">
                            <!-- Les images importées apparaîtront ici -->
                        </div>
                    </div>
                    
                    <!-- Section pour la couleur du carton -->
                    <div class="form-group">
                        <label>Couleur du Carton *</label>
                        <div class="color-picker-container">
                            <div class="color-option selected" data-color="#3b82f6" style="background-color: #3b82f6;"></div>
                            <div class="color-option" data-color="#f97316" style="background-color: #f97316;"></div>
                            <div class="color-option" data-color="#10b981" style="background-color: #10b981;"></div>
                            <div class="color-option" data-color="#8b5cf6" style="background-color: #8b5cf6;"></div>
                            <div class="color-option" data-color="#ef4444" style="background-color: #ef4444;"></div>
                            <div class="color-option" data-color="#fbbf24" style="background-color: #fbbf24;"></div>
                            <div class="color-option" data-color="#64748b" style="background-color: #64748b;"></div>
                            <div class="color-option" data-color="#ffffff" style="background-color: #ffffff; border: 1px solid #d1d5db;"></div>
                        </div>
                        <input type="hidden" id="material-color" value="#3b82f6">
                    </div>
                    
                    <!-- Section pour la sélection de position -->
                    <div class="form-group shelf-selection">
                        <label for="shelf-select">Sélection de la Position *</label>
                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <label for="shelf-select">Étagère</label>
                                <select id="shelf-select" class="form-control" required>
                                    <option value="">Sélectionner une étagère</option>
                                    <!-- Les étagères seront chargées dynamiquement -->
                                </select>
                            </div>
                            <div style="flex: 1;">
                                <label for="shelf-position-select">Position</label>
                                <select id="shelf-position-select" class="form-control" required disabled>
                                    <option value="">Sélectionner d'abord une étagère</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="shelf-visualization" id="shelf-visualization">
                            <p style="color: #64748b; text-align: center;">Sélectionnez d'abord une étagère pour voir les places disponibles</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="material-notes">Notes Additionnelles</label>
                        <textarea id="material-notes" class="form-control" rows="3" placeholder="Informations supplémentaires..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary close-modal">Annuler</button>
                        <button type="submit" class="btn btn-primary">Enregistrer le Matériel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal pour créer une étagère -->
    <div class="modal" id="createShelfModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> Créer une Nouvelle Étagère</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-shelf-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shelf-name">Nom de l'étagère *</label>
                            <input type="text" id="shelf-name" class="form-control" required placeholder="Ex: Étagère Outillage">
                        </div>
                        <div class="form-group">
                            <label for="shelf-color">Couleur de l'étagère *</label>
                            <input type="color" id="shelf-color" class="form-control" value="#3b82f6" style="height: 50px;">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shelf-row">Rangée *</label>
                            <select id="shelf-row" class="form-control" required>
                                <option value="">Sélectionner une rangée</option>
                                <option value="A">Rangée A</option>
                                <option value="B">Rangée B</option>
                                <option value="C">Rangée C</option>
                                <option value="D">Rangée D</option>
                                <option value="E">Rangée E</option>
                                <option value="F">Rangée F</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="shelf-number">Numéro d'étagère *</label>
                            <select id="shelf-number" class="form-control" required>
                                <option value="">Sélectionner un numéro</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Prévisualisation de l'étagère</label>
                        <div id="shelf-preview" style="width: 100%; height: 150px; background: #f8fafc; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #64748b; border: 2px dashed #cbd5e1;">
                            L'étagère apparaîtra ici
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary close-modal">Annuler</button>
                        <button type="submit" class="btn btn-primary">Créer l'Étagère</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal pour voir les détails d'un matériel -->
    <div class="modal" id="viewMaterialModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3><i class="fas fa-eye"></i> Détails du Matériel</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="material-detail" id="material-detail-content">
                    <!-- Les détails seront chargés ici -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal pour planifier une inspection -->
    <div class="modal" id="inspectionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-plus"></i> Planifier une Inspection</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="inspection-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="inspection-date">Date de l'inspection *</label>
                            <input type="datetime-local" id="inspection-date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="inspection-type">Type d'inspection *</label>
                            <select id="inspection-type" class="form-control" required>
                                <option value="hebdomadaire">Hebdomadaire</option>
                                <option value="mensuelle">Mensuelle</option>
                                <option value="trimestrielle">Trimestrielle</option>
                                <option value="annuelle">Annuelle</option>
                                <option value="ponctuelle">Ponctuelle</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="inspection-materials">Matériel à inspecter *</label>
                        <div style="border: 2px solid #e2e8f0; border-radius: 10px; padding: 15px; max-height: 200px; overflow-y: auto;">
                            <div id="materials-checklist">
                                <!-- La liste des matériels sera chargée ici -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="inspection-notes">Notes d'inspection</label>
                        <textarea id="inspection-notes" class="form-control" rows="3" placeholder="Notes spécifiques pour cette inspection..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary close-modal">Annuler</button>
                        <button type="submit" class="btn btn-primary">Planifier l'Inspection</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // Configuration de l'API
        const API_BASE_URL = 'http://localhost:5000/api';
        
        // Variables globales
        let materials = [];
        let shelves = [];
        let inspections = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let totalMaterials = 0;
        
        // Variables pour la scène 3D
        let scene, camera, renderer, controls;
        let textureLoader = new THREE.TextureLoader();
        let materialMeshes = [];
        let shelfMeshes = [];
        let showLabels = true;
        let showGrid = true;
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Configuration de Toastr
            toastr.options = {
                "closeButton": true,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "timeOut": "3000"
            };
            
            // Initialiser les dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('entry-date').value = today;
            document.getElementById('inspection-date').value = new Date().toISOString().slice(0, 16);
            
            // Navigation entre les sections
            setupNavigation();
            
            // Initialiser les événements
            setupEventListeners();
            
            // Charger les données initiales
            loadInitialData();
        });
        
        // Configuration de la navigation
        function setupNavigation() {
            const menuItems = document.querySelectorAll('.menu-item');
            const sections = {
                'dashboard': document.getElementById('dashboard-section'),
                'warehouse': document.getElementById('warehouse-section'),
                'materials': document.getElementById('materials-section'),
                'add-material': document.getElementById('addMaterialModal'),
                'shelves': document.getElementById('shelves-section'),
                'inspections': document.getElementById('inspections-section'),
                'reports': document.getElementById('reports-section')
            };
            
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    
                    // Gérer les modales séparément
                    if (sectionId === 'add-material') {
                        showAddMaterialModal();
                        return;
                    }
                    
                    // Mettre à jour le menu actif
                    menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Afficher la section correspondante
                    Object.keys(sections).forEach(key => {
                        if (sections[key]) {
                            sections[key].style.display = 'none';
                        }
                    });
                    
                    if (sections[sectionId]) {
                        sections[sectionId].style.display = 'block';
                        
                        // Charger les données spécifiques à la section
                        switch(sectionId) {
                            case 'dashboard':
                                loadDashboardData();
                                break;
                            case 'warehouse':
                                init3DWarehouse();
                                break;
                            case 'materials':
                                loadMaterials();
                                break;
                            case 'shelves':
                                loadShelves();
                                break;
                            case 'inspections':
                                loadInspections();
                                break;
                            case 'reports':
                                generateReports();
                                break;
                        }
                    }
                });
            });
            
            // Navigation via les cartes du dashboard
            document.querySelectorAll('.card[data-section]').forEach(card => {
                card.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    const filter = this.getAttribute('data-filter');
                    
                    // Trouver l'élément de menu correspondant
                    const menuItem = document.querySelector(`.menu-item[data-section="${sectionId}"]`);
                    if (menuItem) {
                        menuItem.click();
                        
                        // Appliquer un filtre si spécifié
                        if (filter && sectionId === 'materials') {
                            setTimeout(() => {
                                const [key, value] = filter.split('=');
                                if (key && value) {
                                    document.getElementById(`${key}-filter`).value = value;
                                    loadMaterials();
                                }
                            }, 100);
                        }
                    }
                });
            });
        }
        
        // Configuration des événements
        function setupEventListeners() {
            // Boutons d'ouverture de modales
            document.getElementById('add-material-btn').addEventListener('click', showAddMaterialModal);
            document.getElementById('quick-add').addEventListener('click', showAddMaterialModal);
            document.getElementById('create-shelf-btn').addEventListener('click', showCreateShelfModal);
            document.getElementById('create-shelf-modal-btn').addEventListener('click', showCreateShelfModal);
            document.getElementById('new-inspection-btn').addEventListener('click', showInspectionModal);
            
            // Fermer les modales
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                });
            });
            
            // Fermer les modales en cliquant à l'extérieur
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });
            
            // Gestion de l'image
            document.getElementById('image-upload-area').addEventListener('click', function() {
                document.getElementById('material-image-input').click();
            });
            
            document.getElementById('material-image-input').addEventListener('change', handleImageUpload);
            
            // Gestion de la condition
            const conditionSlider = document.getElementById('material-condition');
            const conditionValue = document.getElementById('condition-value');
            
            conditionSlider.addEventListener('input', function() {
                const value = this.value;
                conditionValue.textContent = `${value}%`;
                
                // Changer la couleur en fonction de la valeur
                if (value >= 80) {
                    conditionValue.style.color = '#10b981';
                } else if (value >= 40) {
                    conditionValue.style.color = '#f59e0b';
                } else {
                    conditionValue.style.color = '#ef4444';
                }
            });
            
            // Sélecteur de couleur
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('material-color').value = this.dataset.color;
                });
            });
            
            // Sélection d'étagère
            document.getElementById('shelf-select').addEventListener('change', function() {
                const shelfId = this.value;
                if (shelfId) {
                    loadShelfPositions(shelfId);
                } else {
                    document.getElementById('shelf-position-select').disabled = true;
                    document.getElementById('shelf-visualization').innerHTML = 
                        '<p style="color: #64748b; text-align: center;">Sélectionnez d\'abord une étagère pour voir les places disponibles</p>';
                }
            });
            
            // Formulaire d'ajout de matériel
            document.getElementById('add-material-form').addEventListener('submit', handleAddMaterial);
            
            // Formulaire de création d'étagère
            document.getElementById('create-shelf-form').addEventListener('submit', handleCreateShelf);
            
            // Formulaire d'inspection
            document.getElementById('inspection-form').addEventListener('submit', handleCreateInspection);
            
            // Recherche et filtres
            document.getElementById('search-input').addEventListener('input', debounce(loadMaterials, 300));
            document.getElementById('category-filter').addEventListener('change', loadMaterials);
            document.getElementById('state-filter').addEventListener('change', loadMaterials);
            document.getElementById('shelf-filter').addEventListener('change', loadMaterials);
            
            // Pagination
            document.getElementById('prev-page').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadMaterials();
                }
            });
            
            document.getElementById('next-page').addEventListener('click', () => {
                if (currentPage * itemsPerPage < totalMaterials) {
                    currentPage++;
                    loadMaterials();
                }
            });
            
            // Export
            document.getElementById('export-btn').addEventListener('click', exportMaterials);
            
            // Prévisualisation de la couleur de l'étagère
            document.getElementById('shelf-color').addEventListener('input', function() {
                const preview = document.getElementById('shelf-preview');
                preview.style.backgroundColor = this.value;
                preview.style.border = '2px solid ' + this.value;
                preview.innerHTML = `<div style="text-align: center;">
                    <div style="font-weight: bold; color: ${getContrastColor(this.value)};">Étagère</div>
                    <div style="font-size: 0.9rem; color: ${getContrastColor(this.value)};">${this.value}</div>
                </div>`;
            });
        }
        
        // Charger les données initiales
        async function loadInitialData() {
            try {
                await Promise.all([
                    loadMaterials(),
                    loadShelves(),
                    loadInspections(),
                    loadStats()
                ]);
                
                loadDashboardData();
                populateShelfFilter();
            } catch (error) {
                console.error('Erreur lors du chargement des données:', error);
                toastr.error('Erreur de chargement des données');
            }
        }
        
        // Charger les statistiques
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/stats`);
                if (!response.ok) throw new Error('Erreur de chargement des stats');
                
                const stats = await response.json();
                
                // Mettre à jour les statistiques
                document.getElementById('stat-total').textContent = stats.totalMaterials;
                document.getElementById('stat-good').textContent = stats.goodMaterials;
                document.getElementById('stat-warning').textContent = stats.warningMaterials;
                document.getElementById('stat-bad').textContent = stats.badMaterials;
                
                document.getElementById('card-total').textContent = stats.totalMaterials;
                document.getElementById('card-good').textContent = stats.goodMaterials;
                document.getElementById('card-shelves').textContent = stats.totalShelves;
                
                // Mettre à jour le nombre d'inspections cette semaine
                const thisWeekInspections = inspections.filter(inspection => {
                    const inspectionDate = new Date(inspection.date);
                    const now = new Date();
                    const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    return inspectionDate >= oneWeekAgo;
                }).length;
                
                document.getElementById('card-inspections').textContent = thisWeekInspections;
            } catch (error) {
                console.error('Erreur lors du chargement des stats:', error);
            }
        }
        
        // Charger les matériels
        async function loadMaterials() {
            try {
                const search = document.getElementById('search-input').value;
                const category = document.getElementById('category-filter').value;
                const state = document.getElementById('state-filter').value;
                const shelf = document.getElementById('shelf-filter').value;
                
                // Construire l'URL avec les paramètres
                let url = `${API_BASE_URL}/materials?`;
                const params = [];
                
                if (search) params.push(`search=${encodeURIComponent(search)}`);
                if (category) params.push(`category=${category}`);
                if (state) params.push(`state=${state}`);
                if (shelf) params.push(`shelf=${shelf}`);
                
                url += params.join('&');
                
                const response = await fetch(url);
                if (!response.ok) throw new Error('Erreur de chargement des matériels');
                
                materials = await response.json();
                totalMaterials = materials.length;
                
                // Pagination
                const start = (currentPage - 1) * itemsPerPage;
                const end = start + itemsPerPage;
                const paginatedMaterials = materials.slice(start, end);
                
                // Mettre à jour le tableau
                updateMaterialsTable(paginatedMaterials);
                
                // Mettre à jour le compteur
                document.getElementById('materials-count').textContent = 
                    `${totalMaterials} matériel(s) trouvé(s)`;
                
                // Mettre à jour la pagination
                updatePagination();
                
                // Mettre à jour les matériels récents (pour le dashboard)
                updateRecentMaterials();
                
            } catch (error) {
                console.error('Erreur lors du chargement des matériels:', error);
                toastr.error('Erreur de chargement des matériels');
            }
        }
        
        // Mettre à jour le tableau des matériels
        function updateMaterialsTable(materials) {
            const tbody = document.getElementById('materials-table-body');
            tbody.innerHTML = '';
            
            if (materials.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #64748b;">
                            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            Aucun matériel trouvé
                        </td>
                    </tr>
                `;
                return;
            }
            
            materials.forEach(material => {
                const row = document.createElement('tr');
                
                // Formater la date
                const entryDate = new Date(material.entryDate);
                const formattedDate = entryDate.toLocaleDateString('fr-FR');
                
                // Déterminer la classe de la barre de progression
                let progressClass = 'progress-bad';
                if (material.condition >= 80) {
                    progressClass = 'progress-good';
                } else if (material.condition >= 40) {
                    progressClass = 'progress-warning';
                }
                
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            ${material.image ? 
                                `<img src="${API_BASE_URL}${material.image}" style="width: 40px; height: 40px; border-radius: 8px; object-fit: cover;">` : 
                                `<div style="width: 40px; height: 40px; border-radius: 8px; background: ${material.color};"></div>`
                            }
                            <div>
                                <div style="font-weight: 600;">${material.name}</div>
                                <div style="font-size: 0.85rem; color: #64748b;">${material.category}</div>
                            </div>
                        </div>
                    </td>
                    <td>${getCategoryLabel(material.category)}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="progress-container">
                                <div class="progress-bar ${progressClass}" style="width: ${material.condition}%"></div>
                            </div>
                            <span class="condition-value">${material.condition}%</span>
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-warehouse" style="color: #64748b;"></i>
                            <span>${material.position}</span>
                        </div>
                    </td>
                    <td class="actions">
                        <button class="action-btn view-material-btn" data-id="${material._id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn edit-material-btn" data-id="${material._id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-material-btn" data-id="${material._id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Ajouter les événements aux boutons
            document.querySelectorAll('.view-material-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const materialId = this.getAttribute('data-id');
                    viewMaterial(materialId);
                });
            });
            
            document.querySelectorAll('.edit-material-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const materialId = this.getAttribute('data-id');
                    editMaterial(materialId);
                });
            });
            
            document.querySelectorAll('.delete-material-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const materialId = this.getAttribute('data-id');
                    deleteMaterial(materialId);
                });
            });
        }
        
        // Mettre à jour la pagination
        function updatePagination() {
            const totalPages = Math.ceil(totalMaterials / itemsPerPage);
            const prevBtn = document.getElementById('prev-page');
            const nextBtn = document.getElementById('next-page');
            const pageInfo = document.getElementById('page-info');
            
            pageInfo.textContent = `Page ${currentPage} sur ${totalPages}`;
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;
        }
        
        // Mettre à jour les matériels récents
        function updateRecentMaterials() {
            const recentMaterials = materials.slice(0, 5);
            const tbody = document.getElementById('recent-materials');
            tbody.innerHTML = '';
            
            recentMaterials.forEach(material => {
                const row = document.createElement('tr');
                const entryDate = new Date(material.entryDate);
                const formattedDate = entryDate.toLocaleDateString('fr-FR');
                
                // Déterminer la classe de la barre de progression
                let progressClass = 'progress-bad';
                if (material.condition >= 80) {
                    progressClass = 'progress-good';
                } else if (material.condition >= 40) {
                    progressClass = 'progress-warning';
                }
                
                row.innerHTML = `
                    <td>${material.name}</td>
                    <td>${getCategoryLabel(material.category)}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="progress-container">
                                <div class="progress-bar ${progressClass}" style="width: ${material.condition}%"></div>
                            </div>
                            <span>${material.condition}%</span>
                        </div>
                    </td>
                    <td>${material.position}</td>
                    <td class="actions">
                        <button class="action-btn view-material-btn" data-id="${material._id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Ajouter les événements aux boutons
            document.querySelectorAll('#recent-materials .view-material-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const materialId = this.getAttribute('data-id');
                    viewMaterial(materialId);
                });
            });
        }
        
        // Charger les étagères
        async function loadShelves() {
            try {
                const response = await fetch(`${API_BASE_URL}/shelves`);
                if (!response.ok) throw new Error('Erreur de chargement des étagères');
                
                shelves = await response.json();
                updateShelvesDisplay();
                
                // Mettre à jour le sélecteur d'étagères dans le formulaire
                updateShelfSelect();
                
            } catch (error) {
                console.error('Erreur lors du chargement des étagères:', error);
                toastr.error('Erreur de chargement des étagères');
            }
        }
        
        // Mettre à jour l'affichage des étagères
        function updateShelvesDisplay() {
            const container = document.getElementById('shelves-cards');
            container.innerHTML = '';
            
            if (shelves.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #64748b;">
                        <i class="fas fa-layer-group" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">Aucune étagère créée</h3>
                        <p>Commencez par créer votre première étagère</p>
                        <button class="btn btn-primary" id="create-first-shelf" style="margin-top: 20px;">
                            <i class="fas fa-plus"></i> Créer une étagère
                        </button>
                    </div>
                `;
                
                document.getElementById('create-first-shelf').addEventListener('click', showCreateShelfModal);
                return;
            }
            
            shelves.forEach(shelf => {
                // Calculer le nombre de positions occupées
                const occupiedPositions = shelf.positions.filter(p => p.occupied).length;
                const totalPositions = shelf.positions.length;
                const occupancyRate = Math.round((occupiedPositions / totalPositions) * 100);
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-icon" style="background: ${shelf.color}; color: white;">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div class="card-content">
                        <h4>${shelf.name}</h4>
                        <p>${shelf.row}${shelf.number}</p>
                        <div style="font-size: 0.9rem; color: #64748b; margin-top: 5px;">
                            ${occupiedPositions}/${totalPositions} places occupées (${occupancyRate}%)
                        </div>
                    </div>
                    <div style="margin-left: auto;">
                        <button class="action-btn delete-shelf-btn" data-id="${shelf._id}" title="Supprimer">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(card);
                
                // Ajouter l'événement de suppression
                card.querySelector('.delete-shelf-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    const shelfId = this.getAttribute('data-id');
                    deleteShelf(shelfId);
                });
            });
        }
        
        // Mettre à jour le sélecteur d'étagères
        function updateShelfSelect() {
            const select = document.getElementById('shelf-select');
            const filterSelect = document.getElementById('shelf-filter');
            
            // Sauvegarder les valeurs sélectionnées
            const selectedValue = select.value;
            const filterSelectedValue = filterSelect.value;
            
            // Vider les options
            select.innerHTML = '<option value="">Sélectionner une étagère</option>';
            filterSelect.innerHTML = '<option value="">Toutes les étagères</option>';
            
            // Ajouter les options
            shelves.forEach(shelf => {
                const option = document.createElement('option');
                option.value = shelf._id;
                option.textContent = `${shelf.name} (${shelf.row}${shelf.number})`;
                select.appendChild(option.cloneNode(true));
                filterSelect.appendChild(option);
            });
            
            // Restaurer les valeurs sélectionnées
            select.value = selectedValue;
            filterSelect.value = filterSelectedValue;
            
            // Si une étagère est sélectionnée, charger ses positions
            if (selectedValue) {
                loadShelfPositions(selectedValue);
            }
        }
        
        // Charger les positions d'une étagère
        async function loadShelfPositions(shelfId) {
            try {
                const shelf = shelves.find(s => s._id === shelfId);
                if (!shelf) return;
                
                const positionSelect = document.getElementById('shelf-position-select');
                const visualization = document.getElementById('shelf-visualization');
                
                // Activer le sélecteur de position
                positionSelect.disabled = false;
                
                // Mettre à jour le sélecteur de position
                positionSelect.innerHTML = '<option value="">Sélectionner une position</option>';
                
                // Créer la visualisation
                visualization.innerHTML = '';
                
                // Organiser les positions par niveau
                const levels = {
                    'Haut': [],
                    'Milieu': [],
                    'Bas': []
                };
                
                shelf.positions.forEach(position => {
                    levels[position.level].push(position);
                });
                
                // Trier chaque niveau par numéro de position
                Object.keys(levels).forEach(level => {
                    levels[level].sort((a, b) => a.positionNumber - b.positionNumber);
                });
                
                // Créer la visualisation
                Object.entries(levels).forEach(([level, positions]) => {
                    const row = document.createElement('div');
                    row.className = 'shelf-row';
                    
                    // Label du niveau
                    const levelLabel = document.createElement('div');
                    levelLabel.style.width = '80px';
                    levelLabel.style.display = 'flex';
                    levelLabel.style.alignItems = 'center';
                    levelLabel.style.color = '#64748b';
                    levelLabel.style.fontWeight = '600';
                    levelLabel.textContent = level;
                    row.appendChild(levelLabel);
                    
                    // Positions
                    positions.forEach(position => {
                        const positionDiv = document.createElement('div');
                        positionDiv.className = 'shelf-position';
                        positionDiv.textContent = position.positionNumber;
                        positionDiv.title = position.positionId;
                        
                        if (position.occupied) {
                            positionDiv.classList.add('occupied');
                            positionDiv.title = 'Occupé: ' + position.positionId;
                        } else {
                            positionDiv.addEventListener('click', function() {
                                // Désélectionner toutes les positions
                                document.querySelectorAll('.shelf-position').forEach(p => {
                                    p.classList.remove('selected');
                                });
                                
                                // Sélectionner cette position
                                this.classList.add('selected');
                                
                                // Mettre à jour le sélecteur
                                positionSelect.value = position.positionId;
                            });
                            
                            // Ajouter l'option au sélecteur
                            const option = document.createElement('option');
                            option.value = position.positionId;
                            option.textContent = `Position ${position.positionNumber} (${level})`;
                            positionSelect.appendChild(option);
                        }
                        
                        row.appendChild(positionDiv);
                    });
                    
                    visualization.appendChild(row);
                });
                
            } catch (error) {
                console.error('Erreur lors du chargement des positions:', error);
            }
        }
        
        // Charger les inspections
        async function loadInspections() {
            try {
                const response = await fetch(`${API_BASE_URL}/inspections`);
                if (!response.ok) throw new Error('Erreur de chargement des inspections');
                
                inspections = await response.json();
                updateInspectionsTable();
                
            } catch (error) {
                console.error('Erreur lors du chargement des inspections:', error);
                toastr.error('Erreur de chargement des inspections');
            }
        }
        
        // Mettre à jour le tableau des inspections
        function updateInspectionsTable() {
            const tbody = document.getElementById('inspections-table-body');
            tbody.innerHTML = '';
            
            if (inspections.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #64748b;">
                            <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            Aucune inspection planifiée
                        </td>
                    </tr>
                `;
                return;
            }
            
            inspections.forEach(inspection => {
                const row = document.createElement('tr');
                const date = new Date(inspection.date);
                const formattedDate = date.toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Récupérer les noms des matériels
                const materialNames = inspection.materials
                    .map(m => m.name)
                    .slice(0, 2)
                    .join(', ');
                
                const moreCount = inspection.materials.length > 2 ? 
                    ` +${inspection.materials.length - 2} autres` : '';
                
                // Déterminer le statut
                let statusClass = 'status-warning';
                let statusText = 'Planifiée';
                
                if (inspection.status === 'completed') {
                    statusClass = 'status-good';
                    statusText = 'Terminée';
                } else if (inspection.status === 'cancelled') {
                    statusClass = 'status-bad';
                    statusText = 'Annulée';
                }
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${inspection.type}</td>
                    <td>${materialNames}${moreCount}</td>
                    <td>${inspection.inspector}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                    <td class="actions">
                        <button class="action-btn view-inspection-btn" data-id="${inspection._id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" onclick="printInspectionReport('${inspection._id}')">
                            <i class="fas fa-print"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // Charger les données du dashboard
        async function loadDashboardData() {
            await loadStats();
            loadRecentMaterials();
        }
        
        // Afficher la modal d'ajout de matériel
        function showAddMaterialModal() {
            // Réinitialiser le formulaire
            document.getElementById('add-material-form').reset();
            document.getElementById('condition-value').textContent = '80%';
            document.getElementById('condition-value').style.color = '#10b981';
            document.getElementById('image-preview-container').innerHTML = '';
            document.getElementById('shelf-visualization').innerHTML = 
                '<p style="color: #64748b; text-align: center;">Sélectionnez d\'abord une étagère pour voir les places disponibles</p>';
            
            // Réinitialiser les sélecteurs
            document.getElementById('shelf-select').value = '';
            document.getElementById('shelf-position-select').innerHTML = '<option value="">Sélectionner d\'abord une étagère</option>';
            document.getElementById('shelf-position-select').disabled = true;
            
            // Définir la date d'aujourd'hui
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('entry-date').value = today;
            
            // Afficher la modal
            document.getElementById('addMaterialModal').style.display = 'flex';
        }
        
        // Afficher la modal de création d'étagère
        function showCreateShelfModal() {
            // Réinitialiser le formulaire
            document.getElementById('create-shelf-form').reset();
            document.getElementById('shelf-color').value = '#3b82f6';
            
            // Mettre à jour la prévisualisation
            const preview = document.getElementById('shelf-preview');
            preview.style.backgroundColor = '#3b82f6';
            preview.style.border = '2px solid #3b82f6';
            preview.innerHTML = `<div style="text-align: center;">
                <div style="font-weight: bold; color: white;">Étagère</div>
                <div style="font-size: 0.9rem; color: white;">#3b82f6</div>
            </div>`;
            
            // Afficher la modal
            document.getElementById('createShelfModal').style.display = 'flex';
        }
        
        // Afficher la modal d'inspection
        async function showInspectionModal() {
            // Charger la liste des matériels pour la checklist
            const checklist = document.getElementById('materials-checklist');
            checklist.innerHTML = '';
            
            materials.forEach(material => {
                const div = document.createElement('div');
                div.style.marginBottom = '10px';
                div.innerHTML = `
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" value="${material._id}" style="width: 18px; height: 18px;">
                        <div>
                            <div style="font-weight: 500;">${material.name}</div>
                            <div style="font-size: 0.85rem; color: #64748b;">${material.position} - Condition: ${material.condition}%</div>
                        </div>
                    </label>
                `;
                checklist.appendChild(div);
            });
            
            // Définir la date par défaut (demain à 9h)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(9, 0, 0, 0);
            
            const datetimeLocal = tomorrow.toISOString().slice(0, 16);
            document.getElementById('inspection-date').value = datetimeLocal;
            
            // Afficher la modal
            document.getElementById('inspectionModal').style.display = 'flex';
        }
        
        // Gérer l'upload d'image
        function handleImageUpload(e) {
            const files = e.target.files;
            const previewContainer = document.getElementById('image-preview-container');
            previewContainer.innerHTML = '';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Vérifier la taille du fichier (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    toastr.error('L\'image ne doit pas dépasser 5MB');
                    continue;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const imgData = e.target.result;
                    
                    // Créer l'élément de prévisualisation
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    
                    const img = document.createElement('img');
                    img.src = imgData;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-image';
                    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    removeBtn.addEventListener('click', function() {
                        previewContainer.removeChild(previewItem);
                        document.getElementById('material-image-input').value = '';
                    });
                    
                    previewItem.appendChild(img);
                    previewItem.appendChild(removeBtn);
                    previewContainer.appendChild(previewItem);
                };
                
                reader.readAsDataURL(file);
            }
        }
        
        // Gérer l'ajout de matériel
        async function handleAddMaterial(e) {
            e.preventDefault();
            
            try {
                const formData = new FormData();
                
                // Récupérer les données du formulaire
                const name = document.getElementById('material-name').value;
                const category = document.getElementById('material-category').value;
                const entryDate = document.getElementById('entry-date').value;
                const condition = document.getElementById('material-condition').value;
                const description = document.getElementById('material-description').value;
                const color = document.getElementById('material-color').value;
                const shelfId = document.getElementById('shelf-select').value;
                const position = document.getElementById('shelf-position-select').value;
                const notes = document.getElementById('material-notes').value;
                
                // Vérifier qu'une image a été sélectionnée
                const imageInput = document.getElementById('material-image-input');
                if (!imageInput.files[0]) {
                    toastr.error('Veuillez sélectionner une image');
                    return;
                }
                
                // Vérifier qu'une position a été sélectionnée
                if (!position) {
                    toastr.error('Veuillez sélectionner une position');
                    return;
                }
                
                // Récupérer l'étagère sélectionnée
                const shelf = shelves.find(s => s._id === shelfId);
                if (!shelf) {
                    toastr.error('Étagère invalide');
                    return;
                }
                
                // Ajouter les données au FormData
                formData.append('name', name);
                formData.append('category', category);
                formData.append('entryDate', entryDate);
                formData.append('condition', condition);
                formData.append('description', description);
                formData.append('color', color);
                formData.append('shelfId', shelfId);
                formData.append('shelf', `${shelf.row}${shelf.number}`);
                formData.append('position', position);
                formData.append('notes', notes);
                formData.append('image', imageInput.files[0]);
                
                // Envoyer la requête
                const response = await fetch(`${API_BASE_URL}/materials`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Erreur lors de l\'ajout du matériel');
                }
                
                const newMaterial = await response.json();
                
                // Ajouter le matériel à la liste
                materials.unshift(newMaterial);
                
                // Mettre à jour l'affichage
                loadMaterials();
                loadShelves();
                loadStats();
                
                // Fermer la modal
                document.getElementById('addMaterialModal').style.display = 'none';
                
                // Afficher un message de succès
                toastr.success('Matériel ajouté avec succès');
                
                // Mettre à jour la scène 3D si elle est active
                if (scene) {
                    addMaterialTo3DScene(newMaterial);
                }
                
            } catch (error) {
                console.error('Erreur lors de l\'ajout du matériel:', error);
                toastr.error(error.message || 'Erreur lors de l\'ajout du matériel');
            }
        }
        
        // Gérer la création d'une étagère
        async function handleCreateShelf(e) {
            e.preventDefault();
            
            try {
                const name = document.getElementById('shelf-name').value;
                const row = document.getElementById('shelf-row').value;
                const number = document.getElementById('shelf-number').value;
                const color = document.getElementById('shelf-color').value;
                
                // Vérifier que tous les champs sont remplis
                if (!name || !row || !number) {
                    toastr.error('Veuillez remplir tous les champs');
                    return;
                }
                
                // Envoyer la requête
                const response = await fetch(`${API_BASE_URL}/shelves`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, row, number, color })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Erreur lors de la création de l\'étagère');
                }
                
                const newShelf = await response.json();
                
                // Ajouter l'étagère à la liste
                shelves.push(newShelf);
                
                // Mettre à jour l'affichage
                updateShelvesDisplay();
                updateShelfSelect();
                
                // Fermer la modal
                document.getElementById('createShelfModal').style.display = 'none';
                
                // Afficher un message de succès
                toastr.success('Étagère créée avec succès');
                
                // Mettre à jour la scène 3D si elle est active
                if (scene) {
                    addShelfTo3DScene(newShelf);
                }
                
            } catch (error) {
                console.error('Erreur lors de la création de l\'étagère:', error);
                toastr.error(error.message || 'Erreur lors de la création de l\'étagère');
            }
        }
        
        // Gérer la création d'une inspection
        async function handleCreateInspection(e) {
            e.preventDefault();
            
            try {
                const date = document.getElementById('inspection-date').value;
                const type = document.getElementById('inspection-type').value;
                const notes = document.getElementById('inspection-notes').value;
                
                // Récupérer les matériels sélectionnés
                const selectedMaterials = Array.from(
                    document.querySelectorAll('#materials-checklist input[type="checkbox"]:checked')
                ).map(checkbox => checkbox.value);
                
                if (selectedMaterials.length === 0) {
                    toastr.error('Veuillez sélectionner au moins un matériel');
                    return;
                }
                
                // Créer l'objet inspection
                const inspection = {
                    date,
                    type,
                    materials: selectedMaterials,
                    inspector: 'LEMOQUE JUNIOR',
                    notes
                };
                
                // Envoyer la requête
                const response = await fetch(`${API_BASE_URL}/inspections`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(inspection)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Erreur lors de la planification de l\'inspection');
                }
                
                const newInspection = await response.json();
                
                // Ajouter l'inspection à la liste
                inspections.push(newInspection);
                
                // Mettre à jour l'affichage
                updateInspectionsTable();
                
                // Fermer la modal
                document.getElementById('inspectionModal').style.display = 'none';
                
                // Afficher un message de succès
                toastr.success('Inspection planifiée avec succès');
                
            } catch (error) {
                console.error('Erreur lors de la planification de l\'inspection:', error);
                toastr.error(error.message || 'Erreur lors de la planification de l\'inspection');
            }
        }
        
        // Voir les détails d'un matériel
        async function viewMaterial(materialId) {
            try {
                const response = await fetch(`${API_BASE_URL}/materials/${materialId}`);
                if (!response.ok) throw new Error('Erreur de chargement du matériel');
                
                const material = await response.json();
                
                // Formater les dates
                const entryDate = new Date(material.entryDate).toLocaleDateString('fr-FR');
                const lastInspection = material.lastInspection ? 
                    new Date(material.lastInspection).toLocaleDateString('fr-FR') : 'Jamais';
                
                // Déterminer l'état basé sur la condition
                let stateText = 'Excellent';
                let stateColor = '#10b981';
                
                if (material.condition < 80) {
                    stateText = 'Bon';
                    stateColor = '#f59e0b';
                }
                if (material.condition < 40) {
                    stateText = 'À remplacer';
                    stateColor = '#ef4444';
                }
                
                // Afficher les détails
                const content = document.getElementById('material-detail-content');
                content.innerHTML = `
                    <div class="material-image">
                        ${material.image ? 
                            `<img src="${API_BASE_URL}${material.image}" alt="${material.name}">` : 
                            `<div style="width: 100%; height: 300px; background: ${material.color}; border-radius: 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                                <i class="fas fa-box"></i>
                            </div>`
                        }
                    </div>
                    <div class="material-info">
                        <h2 style="color: var(--dark-color); margin-bottom: 20px;">${material.name}</h2>
                        
                        <div class="info-item">
                            <div class="info-label">Catégorie</div>
                            <div class="info-value">${getCategoryLabel(material.category)}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Description</div>
                            <div class="info-value">${material.description || 'Aucune description'}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Condition</div>
                            <div class="info-value">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div class="progress-container" style="width: 200px;">
                                        <div class="progress-bar" style="width: ${material.condition}%; background: ${stateColor};"></div>
                                    </div>
                                    <div style="font-weight: bold; color: ${stateColor};">
                                        ${material.condition}% - ${stateText}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Localisation</div>
                            <div class="info-value">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-warehouse" style="color: var(--primary-color);"></i>
                                    <span>${material.position}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Date d'entrée</div>
                            <div class="info-value">${entryDate}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Dernière inspection</div>
                            <div class="info-value">${lastInspection}</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Couleur du carton</div>
                            <div class="info-value">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 30px; height: 30px; border-radius: 6px; background: ${material.color};"></div>
                                    <span>${material.color}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Notes</div>
                            <div class="info-value">${material.notes || 'Aucune note'}</div>
                        </div>
                    </div>
                `;
                
                // Afficher la modal
                document.getElementById('viewMaterialModal').style.display = 'flex';
                
            } catch (error) {
                console.error('Erreur lors de la récupération du matériel:', error);
                toastr.error('Erreur de chargement du matériel');
            }
        }
        
        // Éditer un matériel
        async function editMaterial(materialId) {
            // Pour l'instant, rediriger vers la vue détaillée
            viewMaterial(materialId);
            // TODO: Implémenter l'édition complète
            toastr.info('Fonction d\'édition à implémenter');
        }
        
        // Supprimer un matériel
        async function deleteMaterial(materialId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer ce matériel ?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/materials/${materialId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) throw new Error('Erreur lors de la suppression');
                
                // Supprimer le matériel de la liste
                materials = materials.filter(m => m._id !== materialId);
                
                // Mettre à jour l'affichage
                loadMaterials();
                loadStats();
                
                // Supprimer de la scène 3D si elle est active
                if (scene) {
                    removeMaterialFrom3DScene(materialId);
                }
                
                toastr.success('Matériel supprimé avec succès');
                
            } catch (error) {
                console.error('Erreur lors de la suppression du matériel:', error);
                toastr.error('Erreur lors de la suppression du matériel');
            }
        }
        
        // Supprimer une étagère
        async function deleteShelf(shelfId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer cette étagère ? Tous les matériels qu\'elle contient seront déplacés.')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/shelves/${shelfId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) throw new Error('Erreur lors de la suppression');
                
                // Supprimer l'étagère de la liste
                shelves = shelves.filter(s => s._id !== shelfId);
                
                // Mettre à jour l'affichage
                updateShelvesDisplay();
                updateShelfSelect();
                
                // Supprimer de la scène 3D si elle est active
                if (scene) {
                    removeShelfFrom3DScene(shelfId);
                }
                
                toastr.success('Étagère supprimée avec succès');
                
            } catch (error) {
                console.error('Erreur lors de la suppression de l\'étagère:', error);
                toastr.error('Erreur lors de la suppression de l\'étagère');
            }
        }
        
        // Exporter les matériels
        async function exportMaterials() {
            try {
                // Créer le contenu CSV
                let csv = 'Nom,Catégorie,Date d\'entrée,Condition,Position,État\n';
                
                materials.forEach(material => {
                    csv += `"${material.name}","${getCategoryLabel(material.category)}","${new Date(material.entryDate).toLocaleDateString('fr-FR')}",${material.condition}%,"${material.position}","${material.state}"\n`;
                });
                
                // Créer un blob et télécharger
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `materiels_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                toastr.success('Export réalisé avec succès');
                
            } catch (error) {
                console.error('Erreur lors de l\'export:', error);
                toastr.error('Erreur lors de l\'export');
            }
        }
        
        // Générer les rapports
        async function generateReports() {
            // Pour l'instant, afficher des données simulées
            // TODO: Implémenter avec Chart.js ou une librairie similaire
            
            const conditionChart = document.getElementById('condition-chart');
            const categoryChart = document.getElementById('category-chart');
            const inspectionHistory = document.getElementById('inspection-history');
            
            // Calculer les statistiques de condition
            const excellent = materials.filter(m => m.condition >= 80).length;
            const good = materials.filter(m => m.condition >= 40 && m.condition < 80).length;
            const poor = materials.filter(m => m.condition < 40).length;
            
            conditionChart.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <h4 style="margin-bottom: 20px;">Répartition par condition</h4>
                    <div style="display: flex; justify-content: center; gap: 30px; margin-top: 20px;">
                        <div>
                            <div style="width: 150px; height: 150px; border-radius: 50%; background: conic-gradient(#10b981 0% ${(excellent/materials.length)*100}%, #f59e0b ${(excellent/materials.length)*100}% ${((excellent+good)/materials.length)*100}%, #ef4444 ${((excellent+good)/materials.length)*100}% 100%);"></div>
                        </div>
                        <div style="text-align: left;">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 15px; height: 15px; background-color: #10b981; border-radius: 3px; margin-right: 10px;"></div>
                                <div>
                                    <div style="font-weight: 600;">Excellent (80-100%)</div>
                                    <div>${excellent} matériel(s) - ${Math.round((excellent/materials.length)*100)}%</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <div style="width: 15px; height: 15px; background-color: #f59e0b; border-radius: 3px; margin-right: 10px;"></div>
                                <div>
                                    <div style="font-weight: 600;">Bon (40-79%)</div>
                                    <div>${good} matériel(s) - ${Math.round((good/materials.length)*100)}%</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <div style="width: 15px; height: 15px; background-color: #ef4444; border-radius: 3px; margin-right: 10px;"></div>
                                <div>
                                    <div style="font-weight: 600;">À remplacer (0-39%)</div>
                                    <div>${poor} matériel(s) - ${Math.round((poor/materials.length)*100)}%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Calculer les statistiques par catégorie
            const categories = {};
            materials.forEach(material => {
                categories[material.category] = (categories[material.category] || 0) + 1;
            });
            
            let categoryHtml = '<h4 style="margin-bottom: 20px;">Répartition par catégorie</h4>';
            
            Object.entries(categories).forEach(([category, count]) => {
                const percentage = Math.round((count / materials.length) * 100);
                categoryHtml += `
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${getCategoryLabel(category)}</span>
                            <span>${count} (${percentage}%)</span>
                        </div>
                        <div style="height: 10px; background-color: #e2e8f0; border-radius: 5px; overflow: hidden;">
                            <div style="height: 100%; width: ${percentage}%; background-color: var(--secondary-color);"></div>
                        </div>
                    </div>
                `;
            });
            
            categoryChart.innerHTML = categoryHtml;
            
            // Historique des inspections
            const last30Days = inspections.filter(inspection => {
                const inspectionDate = new Date(inspection.date);
                const now = new Date();
                const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                return inspectionDate >= thirtyDaysAgo;
            });
            
            if (last30Days.length > 0) {
                let historyHtml = '<h4 style="margin-bottom: 20px;">Inspections des 30 derniers jours</h4>';
                
                last30Days.forEach(inspection => {
                    const date = new Date(inspection.date).toLocaleDateString('fr-FR');
                    const completed = inspection.status === 'completed';
                    
                    historyHtml += `
                        <div style="background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <strong>${date}</strong>
                                <span style="color: ${completed ? '#10b981' : '#f59e0b'}; font-weight: 600;">
                                    ${completed ? 'Terminée' : 'Planifiée'}
                                </span>
                            </div>
                            <div style="color: #64748b; font-size: 0.9rem;">
                                ${inspection.materials.length} matériel(s) inspecté(s)
                            </div>
                        </div>
                    `;
                });
                
                inspectionHistory.innerHTML = historyHtml;
            } else {
                inspectionHistory.innerHTML = `
                    <div style="text-align: center;">
                        <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 15px; color: #cbd5e1;"></i>
                        <p>Aucune inspection réalisée dans les 30 derniers jours</p>
                    </div>
                `;
            }
        }
        
        // Initialiser l'entrepôt 3D
        function init3DWarehouse() {
            const container = document.getElementById('warehouse-3d');
            if (!container) return;
            
            // Nettoyer le contenu précédent
            container.innerHTML = '';
            materialMeshes = [];
            shelfMeshes = [];
            
            // Créer la scène
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf8fafc);
            
            // Créer la caméra
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(25, 20, 25);
            
            // Créer le rendu
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // Contrôles de la caméra
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxPolarAngle = Math.PI / 2 - 0.1; // Empêcher de passer sous le sol
            
            // Lumière ambiante
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            // Lumière directionnelle
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Créer le sol
            const floorGeometry = new THREE.PlaneGeometry(50, 50);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xffffff,
                roughness: 0.8,
                metalness: 0.2
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // Grille
            const gridHelper = new THREE.GridHelper(50, 50, 0xcbd5e1, 0xe2e8f0);
            gridHelper.visible = showGrid;
            scene.add(gridHelper);
            
            // Ajouter les étagères à la scène
            shelves.forEach(shelf => {
                addShelfTo3DScene(shelf);
            });
            
            // Ajouter les matériels à la scène
            materials.forEach(material => {
                addMaterialTo3DScene(material);
            });
            
            // Animation
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();
            
            // Gestion du redimensionnement
            window.addEventListener('resize', function() {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
            
            // Contrôles de la vue 3D
            document.getElementById('reset-view').addEventListener('click', function() {
                controls.reset();
                camera.position.set(25, 20, 25);
                controls.update();
            });
            
            document.getElementById('toggle-labels').addEventListener('click', function() {
                showLabels = !showLabels;
                materialMeshes.forEach(mesh => {
                    if (mesh.userData.label) {
                        mesh.userData.label.visible = showLabels;
                    }
                });
                this.innerHTML = showLabels ? 
                    '<i class="fas fa-tag"></i> Cacher Étiquettes' : 
                    '<i class="fas fa-tag"></i> Afficher Étiquettes';
            });
            
            document.getElementById('toggle-grid').addEventListener('click', function() {
                showGrid = !showGrid;
                gridHelper.visible = showGrid;
                this.innerHTML = showGrid ? 
                    '<i class="fas fa-th"></i> Cacher Grille' : 
                    '<i class="fas fa-th"></i> Afficher Grille';
            });
            
            // Gestion du survol
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            
            function onMouseMove(event) {
                const rect = renderer.domElement.getBoundingClientRect();
                mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
                
                raycaster.setFromCamera(mouse, camera);
                
                const intersects = raycaster.intersectObjects(materialMeshes);
                
                // Réinitialiser l'échelle de tous les matériels
                materialMeshes.forEach(mesh => {
                    mesh.scale.set(1, 1, 1);
                });
                
                if (intersects.length > 0) {
                    const hoveredMesh = intersects[0].object;
                    hoveredMesh.scale.set(1.1, 1.1, 1.1);
                    
                    // Afficher une info-bulle
                    container.title = hoveredMesh.userData.name;
                } else {
                    container.title = '';
                }
            }
            
            container.addEventListener('mousemove', onMouseMove);
            
            // Gestion du clic
            function onMouseClick(event) {
                const rect = renderer.domElement.getBoundingClientRect();
                mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
                
                raycaster.setFromCamera(mouse, camera);
                
                const intersects = raycaster.intersectObjects(materialMeshes);
                
                if (intersects.length > 0) {
                    const clickedMesh = intersects[0].object;
                    viewMaterial(clickedMesh.userData.id);
                }
            }
            
            container.addEventListener('click', onMouseClick);
        }
        
        // Ajouter une étagère à la scène 3D
        function addShelfTo3DScene(shelf) {
            // Positionner l'étagère dans la scène
            // Nous allons utiliser un système de coordonnées basé sur la rangée et le numéro
            const rowIndex = ['A', 'B', 'C', 'D', 'E', 'F'].indexOf(shelf.row);
            const shelfNum = parseInt(shelf.number);
            
            const x = -20 + rowIndex * 8;
            const z = -15 + (shelfNum - 1) * 6;
            
            // Couleur de l'étagère
            const shelfColor = parseInt(shelf.color.replace('#', '0x'));
            
            // Base de l'étagère
            const baseGeometry = new THREE.BoxGeometry(6, 0.5, 4);
            const baseMaterial = new THREE.MeshStandardMaterial({ 
                color: shelfColor,
                roughness: 0.9,
                metalness: 0.1
            });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.set(x, 0.25, z);
            base.castShadow = true;
            base.receiveShadow = true;
            base.userData = { type: 'shelf', id: shelf._id, shelf: shelf };
            scene.add(base);
            shelfMeshes.push(base);
            
            // Montants verticaux
            const verticalGeometry = new THREE.BoxGeometry(0.3, 5, 0.3);
            const verticalPositions = [
                { x: -2.5, z: -1.5 },
                { x: 2.5, z: -1.5 },
                { x: -2.5, z: 1.5 },
                { x: 2.5, z: 1.5 }
            ];
            
            verticalPositions.forEach(pos => {
                const vertical = new THREE.Mesh(verticalGeometry, baseMaterial);
                vertical.position.set(x + pos.x, 2.5, z + pos.z);
                vertical.castShadow = true;
                scene.add(vertical);
            });
            
            // Plateaux (3 niveaux)
            for (let level = 0; level < 3; level++) {
                const shelfGeometry = new THREE.BoxGeometry(6, 0.2, 4);
                const shelfMesh = new THREE.Mesh(shelfGeometry, baseMaterial);
                shelfMesh.position.set(x, (level + 1) * 1.5, z);
                shelfMesh.castShadow = true;
                shelfMesh.receiveShadow = true;
                scene.add(shelfMesh);
            }
            
            // Étiquette de l'étagère
            const canvas = createTextCanvas(`${shelf.row}${shelf.number}`, '#ffffff');
            const texture = new THREE.CanvasTexture(canvas);
            const labelMaterial = new THREE.SpriteMaterial({ map: texture });
            const label = new THREE.Sprite(labelMaterial);
            label.position.set(x, 5.5, z);
            label.scale.set(3, 1, 1);
            scene.add(label);
        }
        
        // Ajouter un matériel à la scène 3D
        function addMaterialTo3DScene(material) {
            // Trouver l'étagère correspondante
            const shelf = shelves.find(s => s._id === material.shelfId);
            if (!shelf) return;
            
            // Positionner le matériel
            const rowIndex = ['A', 'B', 'C', 'D', 'E', 'F'].indexOf(shelf.row);
            const shelfNum = parseInt(shelf.number);
            
            const baseX = -20 + rowIndex * 8;
            const baseZ = -15 + (shelfNum - 1) * 6;
            
            // Déterminer la position exacte
            const positionParts = material.position.split('-')[1];
            if (!positionParts) return;
            
            const levelChar = positionParts.charAt(0);
            const posNum = parseInt(positionParts.charAt(1));
            
            let posY, posX, posZ;
            
            // Niveau
            if (levelChar === 'H') {
                posY = 4; // Haut
            } else if (levelChar === 'M') {
                posY = 2.5; // Milieu
            } else {
                posY = 1; // Bas
            }
            
            // Position horizontale
            if (posNum === 1) {
                posX = baseX - 1.5;
                posZ = baseZ - 1;
            } else if (posNum === 2) {
                posX = baseX;
                posZ = baseZ - 1;
            } else if (posNum === 3) {
                posX = baseX + 1.5;
                posZ = baseZ - 1;
            } else {
                posX = baseX;
                posZ = baseZ;
            }
            
            // Créer le cube
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            
            // Déterminer la couleur basée sur la condition
            let materialColor;
            if (material.condition >= 80) {
                materialColor = 0x10b981; // Vert
            } else if (material.condition >= 40) {
                materialColor = 0xf59e0b; // Orange
            } else {
                materialColor = 0xef4444; // Rouge
            }
            
            const cubeMaterial = new THREE.MeshStandardMaterial({ 
                color: materialColor,
                roughness: 0.7,
                metalness: 0.3
            });
            
            const cube = new THREE.Mesh(geometry, cubeMaterial);
            cube.position.set(posX, posY, posZ);
            cube.castShadow = true;
            cube.receiveShadow = true;
            cube.userData = {
                id: material._id,
                name: material.name,
                type: 'material',
                material: material
            };
            
            scene.add(cube);
            materialMeshes.push(cube);
            
            // Étiquette
            if (showLabels) {
                const canvas = createTextCanvas(material.name.substring(0, 10), '#1e293b');
                const texture = new THREE.CanvasTexture(canvas);
                const labelMaterial = new THREE.SpriteMaterial({ map: texture });
                const label = new THREE.Sprite(labelMaterial);
                label.position.set(posX, posY + 0.8, posZ);
                label.scale.set(2, 0.6, 1);
                label.userData = { type: 'label' };
                cube.userData.label = label;
                scene.add(label);
            }
        }
        
        // Supprimer un matériel de la scène 3D
        function removeMaterialFrom3DScene(materialId) {
            const meshIndex = materialMeshes.findIndex(mesh => mesh.userData.id === materialId);
            if (meshIndex !== -1) {
                const mesh = materialMeshes[meshIndex];
                
                // Supprimer l'étiquette si elle existe
                if (mesh.userData.label) {
                    scene.remove(mesh.userData.label);
                }
                
                // Supprimer le mesh
                scene.remove(mesh);
                materialMeshes.splice(meshIndex, 1);
            }
        }
        
        // Supprimer une étagère de la scène 3D
        function removeShelfFrom3DScene(shelfId) {
            // Pour simplifier, nous allons recréer toute la scène
            init3DWarehouse();
        }
        
        // Créer un canvas de texte
        function createTextCanvas(text, color) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 64;
            
            // Fond
            context.fillStyle = 'rgba(255, 255, 255, 0.9)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // Bordure
            context.strokeStyle = color;
            context.lineWidth = 2;
            context.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);
            
            // Texte
            context.font = 'bold 14px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillStyle = color;
            context.fillText(text, canvas.width / 2, canvas.height / 2);
            
            return canvas;
        }
        
        // Fonctions utilitaires
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        function getCategoryLabel(category) {
            const labels = {
                'informatique': 'Informatique',
                'outillage': 'Outillage',
                'mesure': 'Mesure',
                'reseau': 'Réseau',
                'divers': 'Divers'
            };
            return labels[category] || category;
        }
        
        function getContrastColor(hexcolor) {
            hexcolor = hexcolor.replace('#', '');
            const r = parseInt(hexcolor.substr(0, 2), 16);
            const g = parseInt(hexcolor.substr(2, 2), 16);
            const b = parseInt(hexcolor.substr(4, 2), 16);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            return brightness > 128 ? '#000000' : '#ffffff';
        }
        
        function populateShelfFilter() {
            // Cette fonction est appelée dans loadInitialData
            // Le filtre est déjà mis à jour par updateShelfSelect()
        }
        
        // Initialisation au chargement
        window.addEventListener('load', function() {
            // Simuler une connexion utilisateur
            console.log('🚀 TECHNIC-GEST initialisé');
            console.log('👤 Utilisateur: LEMOQUE JUNIOR');
            console.log('🌐 API: http://localhost:5000/api');
            
            // Afficher un message de bienvenue
            setTimeout(() => {
                toastr.info('Bienvenue LEMOQUE JUNIOR', 'TECHNIC-GEST');
            }, 1000);
        });
    </script>
</body>
</html>
